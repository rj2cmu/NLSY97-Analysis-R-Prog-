---
title: "NLSY97 Analysis (Based on Gender)"
author: "Anum Malik, Rishabh Jain, Javier Rico Aristizabal"
date: ''
output: html_document
---

#### Package loading

```{r}
library(tidyverse)
library(knitr)
```


#### Importing the data

```{r}
# Import starting data
nlsy <- read_csv("http://www.andrew.cmu.edu/user/achoulde/94842/final_project/nlsy97/nlsy97_Nov2020.csv")
```

#### Variables present in the base data set

To learn more about the data, you can have a look at the [variable codebook file](http://www.andrew.cmu.edu/user/achoulde/94842/final_project/nlsy97/nlsy97_codebook.txt).


Here's how to rename all the variables to the Question Name abbreviation.  **You will want to change the names to be even more descriptive**, but this is a start.

```{r}
# Change column names to question name abbreviations (you will want to change these further)
colnames(nlsy) <- c("PSTRAN_GPA.01_PSTR",
    "INCARC_TOTNUM_XRND",
    "INCARC_AGE_FIRST_XRND",
    "INCARC_LENGTH_LONGEST_XRND",
    "PUBID_1997",
    "YSCH-36400_1997",
    "YSCH-37000_1997",
    "YSAQ-010_1997",
    "Marijuana_1997", #YSAQ-369_1997
    "YEXP-300_1997",
    "%Ch.Dip.20_1997", #YEXP-1500_1997
    "YEXP-1600_1997",
    "%Ch.Baby_1997", #YEXP-1800_1997
    "%Ch.Coll.Degree.30_1997", #YEXP-2000_1997
    "Sex",
    "BDATE_M_1997", #KEY_BDATE_M_1997
    "BDATE_Y_1997", #KEY_BDATE_Y_1997
    "PC8-090_1997",
    "PC8-092_1997",
    "PC9-002_1997",
    "Dep_F_1997", #PC12-024_1997
    "Dep_M_1997", #PC12-028_1997
    "CV_AGE_12/31/96_1997",
    "CV_BIO_MOM_AGE_CHILD1_1997",
    "CV_BIO_MOM_AGE_YOUTH_1997",
    "CV_CITIZENSHIP_1997",
    "CV_ENROLLSTAT_1997",
    "HH_NET_WORTH_P_1997", #CV_HH_NET_WORTH_P_1997
    "CV_YTH_REL_HH_CURRENT_1997",
    "CV_MSA_AGE_12_1997",
    "CV_URBAN-RURAL_AGE_12_1997",
    "CV_SAMPLE_TYPE_1997",
    "CV_HGC_BIO_DAD_1997",
    "CV_HGC_BIO_MOM_1997",
    "Highest.Grade_RES_DAD_1997", #CV_HGC_RES_DAD_1997
    "Highest.Grade_RES_MOM_1997", #CV_HGC_RES_MOM_1997
    "Race",
    "YSCH-6800_1998",
    "YSCH-7300_1998",
    "Ever_Used_Coca_1998", #YSAQ-372B_1998
    "YSAQ-371_2000",
    "Disorganized_2002", #YSAQ-282J_2002
    "YSAQ-282Q_2002",
    "HH_NET_WORTH_Y_2003", #CV_HH_NET_WORTH_Y_2003
    "CV_BA_CREDITS.01_2004",
    "YSAQ-000B_2004", 
    "YSAQ-373_2004",
    "Marijuana_2005", #YSAQ-369_2005
    "Children_HH_2007", #CV_BIO_CHILD_HH_2007
    "YTEL-52~000001_2007",
    "YTEL-52~000002_2007",
    "YTEL-52~000003_2007",
    "YTEL-52~000004_2007",
    "Children_HH_2009", #CV_BIO_CHILD_HH_2009
    "CV_COLLEGE_TYPE.01_2011",
    "Family_Income_2011", #CV_INCOME_FAMILY_2011
    "CV_HH_SIZE_2011",
    "CV_HH_UNDER_18_2011",
    "CV_HH_UNDER_6_2011",
    "Highest_Degree_Prior_2011/12", #CV_HIGHEST_DEGREE_1112_2011
    "Children_HH_2011", #CV_BIO_CHILD_HH_2011
    "Highest_Grade_Completed_2011", #YSCH-3112_2011
    "YSAQ-000A000001_2011", 
    "Height.Inch_2011", #YSAQ-000A000002_2011
    "Weight.Pound_2011", #YSAQ-000B_2011
    "YSAQ-360C_2011",
    "YSAQ-364D_2011",
    "YSAQ-371_2011", 
    "Hard.drugs.DLI_2011", #YSAQ-372CC_2011
    "YSAQ-373_2011",
    "YSAQ-374_2011",
    "Industry_Code_2011", #YEMP_INDCODE-2002.01_2011
    "Children_HH_2015", #CV_BIO_CHILD_HH_2015
    "Industry_Code_2017", #YEMP_INDCODE-2002.01_2017
    "Occupation_Code_2017", #YEMP_OCCODE-2002.01_2017
    "MaritalStatus_2017", #CV_MARSTAT_COLLAPSED_2017
    "YINC-1400_2017",
    "Income",
    "YINC-1800_2017", 
    "YINC-2400_2017",
    "YINC-2600_2017",
    "YINC-2700_2017",
    "CVC_YTH_REL_HH_AGE6_YCHR_XRND",
    "CVC_SAT_MATH_SCORE_2007_XRND",
    "CVC_SAT_VERBAL_SCORE_2007_XRND",
    "CVC_ACT_SCORE_2007_XRND",
    "HH_NET_WORTH_20", #CVC_HH_NET_WORTH_20_XRND
    "HH_NET_WORTH_25", #CVC_HH_NET_WORTH_25_XRND
    "ASSETS_FINANCIAL_25", #CVC_ASSETS_FINANCIAL_25_XRND
    "ASSETS_DEBTS_20", #CVC_ASSETS_DEBTS_20_XRND
    "HH_NET_WORTH_30", #CVC_HH_NET_WORTH_30_XRND
    "CVC_HOUSE_VALUE_30_XRND",
    "CVC_HOUSE_TYPE_30_XRND",
    "ASSETS_FINANCIAL", #CVC_ASSETS_FINANCIAL_30_XRND
    "ASSETS_DEBTS_30") #CVC_ASSETS_DEBTS_30_XRND

### Set all negative values to NA.  
### THIS IS DONE ONLY FOR ILLUSTRATIVE PURPOSES
### DO NOT TAKE THIS APPROACH WITHOUT CAREFUL JUSTIFICATION
nlsy[nlsy < 0]  <- NA
```

#### A note on missing values

Here's an example of what the variable description files look like

```
T76400.00    [YSAQ-372CC]                                   Survey Year: 2011
  PRIMARY VARIABLE

 
             HAS R USED COCAINE/HARD DRUGS SINCE DLI?
 
Excluding marijuana and alcohol, since the date of last interview, have you used
any drugs like cocaine, crack, heroin, or crystal meth, or any other substance 
not prescribed by a doctor, in order to get high or to achieve an altered state?
 
UNIVERSE: All except prisoners in an insecure environment
 
     215       1 YES   (Go To T76401.00)
    7023       0 NO
  -------
    7238
 
Refusal(-1)           74
Don't Know(-2)        26
TOTAL =========>    7338   VALID SKIP(-4)      85     NON-INTERVIEW(-5)    1561
 
Min:              0        Max:              1        Mean:                 .03
 
Lead In: T76397.00[Default] T76399.00[Default]  T76398.00[0:0]
Default Next Question: T76403.00
```

This description says that the numbers -1, -2, -4 and -5 all have a special meaning for this variable.  They denote different types of missingness.  You can recode all of these to `NA`, but you should also think about whether the different missigness indicators are in some way informative.  (i.e., if someone refuses to answer questions related to drug use, might this inform us about their income?) 

#### Getting to know our two main variables.

In the previous chunk of code we have appropriately renamed the variables corresponding to `sex`, `race` and `income` (as reported on the 2017 survey).  Let's have a quick look at what we're working with.

```{r}
table(nlsy$Sex)

table(nlsy$Race)
```

The data codebook tells us that the coding for sex is `Male = 1`, `Female = 2`.  For the race/ethnicity variable, the coding is:

```
1 Black
2 Hispanic
3 Mixed Race (Non-Hispanic)
4 Non-Black / Non-Hispanic
```

You'll want to do some data manipulations to change away from the numeric codings to more interpretable labels. 

```{r}
summary(nlsy$Income)

# Histogram
qplot(nlsy$Income)
```

The income distributing is right-skewed like one might expect.  However, as indicated in the question description, the income variable is *topcoded* at the 2% level.  More precisely,

```{r}
n.topcoded <- with(nlsy, sum(Income == max(Income, na.rm = TRUE), na.rm = TRUE))
n.topcoded
```

`r n.topcoded` of the incomes are topcoded to the maximum value of `r max(nlsy$income, na.rm = TRUE)`, which is the average value of the top `r n.topcoded` earners. You will want to think about how  to deal with this in your analysis.


The following data `CV_BIO_MOM_AGE_CHILD1_1997` presents the age of biological mother at first birth, differenciating by sex.
```{r}
nlsy <- nlsy %>%
  mutate(Sex = recode_factor(Sex,
                             `1` = "Men",
                             `2` = "Female",
                             `0` = "No Information"))
mom.age.sex <- nlsy %>%
  select(Sex, CV_BIO_MOM_AGE_CHILD1_1997)
qplot(data = mom.age.sex,
      geom = "boxplot",
      x = Sex,
      y = CV_BIO_MOM_AGE_CHILD1_1997,
      fill = Sex)
```
<font color="#157515">
The data presents ages that should be evaluated for biological mothers below 10 years old, and above 60 years old.
</font>

The following creates a dataFrame and deletes those rows where biological age of mothers is less than 12 years old.

```{r}
mom.age.sex <- data.frame(mom.age.sex)
mom.age.sex <- mom.age.sex[!(mom.age.sex$CV_BIO_MOM_AGE_CHILD1_1997<12),]
qplot(data = mom.age.sex,
      geom = "boxplot",
      x = Sex,
      y = CV_BIO_MOM_AGE_CHILD1_1997,
      fill = Sex)
```

```{r}
res.mother.highest.grade <- nlsy %>%
  select(Sex, Highest.Grade_RES_MOM_1997)
resident.mother.highest.grade <- res.mother.highest.grade %>%
  mutate(Highest.Grade_RES_MOM_1997 = recode_factor(Highest.Grade_RES_MOM_1997,
                                             `0` = "NONE",
                                             `1` = "1ST GRADE",
                                             `2` = "2ND GRADE",
                                             `3` = "3RD GRADE",
                                             `4` = "4TH GRADE",
                                             `5` = "5TH GRADE",
                                             `6` = "6TH GRADE",
                                             `7` = "7TH GRADE",
                                             `8` = "8TH GRADE",
                                             `9` = "9TH GRADE",
                                             `10` = "10TH GRADE",
                                             `11` = "11TH GRADE",
                                             `12` = "12TH GRADE",
                                             `95` = "UNGRADED",
                                             `13` = "1ST YEAR COLLEGE",
                                             `14` = "2ND YEAR COLLEGE",
                                             `15` = "3RD YEAR COLLEGE",
                                             `16` = "4TH YEAR COLLEGE",
                                             `17` = "4TH YEAR COLLEGE",
                                             `18` = "4TH YEAR COLLEGE",
                                             `19` = "4TH YEAR COLLEGE",
                                             `20` = "4TH YEAR COLLEGE OR MORE"))

mother.highest.grade <- resident.mother.highest.grade %>%
  group_by(Sex, Highest.Grade_RES_MOM_1997) %>%
  summarize(n = n())
mother.highest.grade <- as_tibble(mother.highest.grade)
plot.mom.grade <- ggplot(data = mother.highest.grade,
                         aes(x = Highest.Grade_RES_MOM_1997,
                             y = n,
                             fill = n))
plot.mom.grade + geom_bar(stat = "identity") + 
  guides(fill = guide_legend(title = "Individuals in each bin")) +
  facet_grid(.~ Sex) +
  theme(axis.text.x=element_text(angle = 90, vjust = 0.5))






```

```{r}
nlsy.recode <- nlsy %>%
  mutate(Sex = recode_factor(Sex,
                                `1` = "Men",
                                `2` = "Female",
                                `0` = "No Information"))
nlsy.recode <- data_frame(nlsy.recode)

income.gender <- nlsy.recode %>%
  group_by(Sex) %>%
  summarize(average.income = mean(Income, na.rm = TRUE), 
            median.income = median(Income, na.rm = TRUE))

kable(income.gender, format = "markdown", digits = 3)

```
<font color="#157515">
When assessing the data via a preliminary scan, we see that the average income for men is `r income.gender$average.income[1]` and the average income for women is `r income.gender$average.income[2]`, which is amounts to a difference of `r income.gender$average.income[1] - income.gender$average.income[2]`.

</font>

```{r}
ggplot(nlsy.recode, aes(Income, fill = Sex)) + geom_histogram(alpha = 0.5, position = 'identity') +
  labs (x = "Income", y = "Number of Respondents")
```

<font color="#157515">
With the histogram, we see that the number of respondents for the lower income ranges are higher for women compared to men whereas as the income progresses on the x-axis; we see men take the lead. Furthermore, we can assess that the data-set is left-skewed, which is why for the purpose of our analysis we will use the median income. 

</font>

```{r}
income.industries <- nlsy.recode %>%
  group_by(Sex, Industry_Code_2017) %>%
  summarize(median.income = median(Income, na.rm = TRUE))
#nlsy.recode['Industry_2017'] <- 'NA'
#class(nlsy.recode$Industry_2017)

industry.decoder <- c(rep(' AGRICULTURE, FORESTRY AND FISHERIES',121),rep('NA',79),
                    rep(' MINING',121),rep('NA',79),rep(' UTILITIES',121),
                    rep('NA',79),rep('CONSTRUCTION',1),rep('NA',299),
                    rep(' MANUFACTURING',2921),rep('NA',79),rep(' WHOLESALE TRADE',521),
                    rep('NA',79),rep(' RETAIL TRADE',1121),rep('NA',99),
                    rep(' ARTS, ENTERTAINMENT AND RECREATION SERVICES',1),
                    rep('NA',179),rep(' TRANSPORTATION AND WAREHOUSING',321),
                    rep('NA',79),rep(' INFORMATION AND COMMUNICATION',311),
                    rep('NA',89),rep(' FINANCE, INSURANCE, AND REAL ESTATE',321),
                    rep('NA',79),rep(' PROFESSIONAL AND RELATED SERVICES',521),
                    rep('NA',69),rep(' EDUCATIONAL, HEALTH, AND SOCIAL SERVICES',611),
                    rep('NA',89),rep(' ENTERTAINMENT, ACCOMODATIONS, AND FOOD SERVICES',131),
                    rep('NA',79),rep(' OTHER SERVICES',521),rep('NA',79),
                    rep(' PUBLIC ADMINISTRATION',221),rep('NA',79),
                    rep(' ACTIVE DUTY MILITARY',221),rep('NA',59),rep(' ACS SPECIAL CODES',41))
names(industry.decoder)<-170:9990
nlsy.recode$Industry_Code_2017 <- sapply(nlsy.recode$Industry_Code_2017, function(x) ifelse(x <= 9990, industry.decoder[as.character(x)], 'NA'))

nlsy.recode <- nlsy.recode %>%
  mutate(nlsy.recode, 
         Industry_Code_2017 = ifelse(is.na(Industry_Code_2017), "Other", Industry_Code_2017))
nlsy.recode
```

```{r}

```


industry.decoder <- c(rep(' AGRICULTURE, FORESTRY AND FISHERIES',121),rep('NA',79),
                    rep(' MINING',121),rep('NA',79),rep(' UTILITIES',121),
                    rep('NA',79),rep('CONSTRUCTION',1),rep('NA',299),
                    rep(' MANUFACTURING',2921),rep('NA',79),rep(' WHOLESALE TRADE',521),
                    rep('NA',79),rep(' RETAIL TRADE',1121),rep('NA',99),
                    rep(' ARTS, ENTERTAINMENT AND RECREATION SERVICES',1),
                    rep('NA',179),rep(' TRANSPORTATION AND WAREHOUSING',321),
                    rep('NA',79),rep(' INFORMATION AND COMMUNICATION',311),
                    rep('NA',89),rep(' FINANCE, INSURANCE, AND REAL ESTATE',321),
                    rep('NA',79),rep(' PROFESSIONAL AND RELATED SERVICES',521),
                    rep('NA',69),rep(' EDUCATIONAL, HEALTH, AND SOCIAL SERVICES',611),
                    rep('NA',89),rep(' ENTERTAINMENT, ACCOMODATIONS, AND FOOD SERVICES',131),
                    rep('NA',79),rep(' OTHER SERVICES',521),rep('NA',79),
                    rep(' PUBLIC ADMINISTRATION',221),rep('NA',79),
                    rep(' ACTIVE DUTY MILITARY',221),rep('NA',59),rep(' ACS SPECIAL CODES',41))
names(industry.decoder)<-170:9990
sapply(nlsy.recode$Industry_2017, function(x) ifelse(x <= 9990, industry.decoder[as.character(x)], 'NA'))
class(nlsy.recode$Industry_2017)





nlsy.recode <- nlsy.recode %>%
  mutate(nlsy.recode, 
         Industry_2017 = ifelse(Industry_Code_2017 >= 170 & Industry_Code_2017 <= 290, "AGRICULTURE, FORESTRY AND FISHERIES","O"))
nlsy.recode$Industry_2017





nlsy.recode <- nlsy.recode %>%
  mutate(nlsy.recode, 
         Industry_2017 = ifelse(Industry_Code_2017 >= 170 & Industry_Code_2017 <= 290, "AGRICULTURE, FORESTRY AND FISHERIES", "Other"))
nlsy.recode$Industry_2017


if(nlsy.recode$Industry_Code_2017 >= 170 & nlsy.recode$Industry_Code_2017 <= 290) {
  nlsy.recode$Industry_2017 = "AGRICULTURE, FORESTRY AND FISHERIES"
  }

```